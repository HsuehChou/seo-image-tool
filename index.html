<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI åœ–ç‰‡ è£åˆ‡å£“ç¸® (é›·ç¥æ¥µè‡´å£“ç¸®ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/compressorjs/1.2.1/compressor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-6 text-left">

    <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-xl border border-slate-100">
        <h2 class="text-2xl font-bold text-slate-800 mb-2 text-center text-left">åœ–ç‰‡ SEO çµ‚æ¥µå£“ç¸®å·¥å…·</h2>
        <p class="text-slate-500 text-sm mb-8 text-center text-left">å°ˆæ¥­ç´šå¼•æ“ | 1200x630 è£åˆ‡ | é«”ç©å¤§å¹…ç¸®æ¸›</p>

        <div class="space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">è‹±æ–‡åç¨± (å¾Œç¶´)</label>
                    <input type="text" id="suffixInput" placeholder="ä¾‹å¦‚: macbook_pro" 
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">å£“ç¸®æ·±åº¦ (è¶Šå°æª”æ¡ˆè¶Šå°)</label>
                    <select id="qualitySelect" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                        <option value="0.5">æ¥µé™å£“ç¸® (é«”ç©æœ€å°)</option>
                        <option value="0.7" selected>å¹³è¡¡æ¨¡å¼ (æ¨è–¦ SEO)</option>
                        <option value="0.9">é«˜å“è³ª (æª”æ¡ˆè¼ƒå¤§)</option>
                    </select>
                </div>
            </div>

            <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
            <button onclick="document.getElementById('fileInput').click()" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all">
                é¸å– 6.5M å¤§åœ–ä¸¦é–‹å§‹å£“ç¸®
            </button>

            <div id="progressList" class="space-y-3 pt-4"></div>

            <button id="downloadBtn" style="display: none;"
                class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg transition-all">
                ä¸‹è¼‰å…¨éƒ¨å„ªåŒ–åœ–ç‰‡ (ZIP)
            </button>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const suffixInput = document.getElementById('suffixInput');
        const qualitySelect = document.getElementById('qualitySelect');
        const progressList = document.getElementById('progressList');
        const downloadBtn = document.getElementById('downloadBtn');

        let processedFiles = [];

        fileInput.addEventListener('change', async (e) => {
            const files = e.target.files;
            const suffix = suffixInput.value.trim();
            const quality = parseFloat(qualitySelect.value);

            if (!suffix) { alert('è«‹è¼¸å…¥åç¨±ï¼'); return; }
            progressList.innerHTML = '';
            processedFiles = [];
            downloadBtn.style.display = 'none';

            for (let i = 0; i < files.length; i++) {
                const index = (i + 1).toString().padStart(2, '0');
                const newFileName = `${suffix}_${index}.jpg`; // JPG å°æ–¼ç…§ç‰‡é¡çš„å£“ç¸®æ•ˆæœé€šå¸¸æ¯” PNG å¥½

                const item = document.createElement('div');
                item.className = "p-4 bg-slate-50 rounded-xl border border-slate-100 flex flex-col gap-2";
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-slate-500">${newFileName}</span>
                        <span id="st-${i}" class="text-xs text-blue-500 font-bold italic">å¼•æ“å£“ç¸®ä¸­...</span>
                    </div>
                    <div id="action-${i}" class="hidden flex justify-end gap-2 mt-2"></div>
                `;
                progressList.appendChild(item);

                try {
                    const compressedBlob = await compressAction(files[i], quality);
                    processedFiles.push({ blob: compressedBlob, name: newFileName });

                    const sizeKB = Math.round(compressedBlob.size / 1024);
                    document.getElementById(`st-${i}`).innerText = `âœ”ï¸ å®Œæˆ (${sizeKB} KB)`;
                    document.getElementById(`st-${i}`).className = 'text-emerald-500 font-bold text-xs';
                    
                    const actionBox = document.getElementById(`action-${i}`);
                    actionBox.classList.remove('hidden');
                    const btn = document.createElement('button');
                    btn.innerText = "ğŸ’¾ å–®å¼µä¸‹è¼‰";
                    btn.className = "text-[10px] bg-white border border-slate-200 px-3 py-1 rounded-lg hover:bg-slate-100 shadow-sm transition-all";
                    btn.onclick = () => {
                        const a = document.createElement('a');
                        a.href = URL.createObjectURL(compressedBlob);
                        a.download = newFileName;
                        a.click();
                    };
                    actionBox.appendChild(btn);
                } catch (err) {
                    document.getElementById(`st-${i}`).innerText = 'âŒ éŒ¯èª¤';
                }
            }
            if (processedFiles.length > 0) downloadBtn.style.display = 'block';
        });

        function compressAction(file, quality) {
            return new Promise((resolve, reject) => {
                new Compressor(file, {
                    quality: quality,
                    width: 1200,
                    height: 630,
                    resize: 'cover', // è‡ªå‹•è£åˆ‡ä¸¦å¡«æ»¿ 1200x630
                    mimeType: 'image/jpeg', // ä½¿ç”¨ JPEG é”åˆ°æœ€ä½³å£“ç¸®ç‡
                    success(result) { resolve(result); },
                    error(err) { reject(err); },
                });
            });
        }

        downloadBtn.onclick = async () => {
            const zip = new JSZip();
            processedFiles.forEach(f => zip.file(f.name, f.blob));
            const content = await zip.generateAsync({type:"blob"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = `${suffixInput.value}_optimized.zip`;
            a.click();
        };
    </script>
</body>
</html>
