<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI åœ–ç‰‡è£åˆ‡ï¼‹å£“ç¸® (é›·ç¥è£½ä½œç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-6">

    <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-xl border border-slate-100">
        <h2 class="text-2xl font-bold text-slate-800 mb-2 text-center">åœ–ç‰‡ SEO çµ‚æ¥µå„ªåŒ–å·¥å…·</h2>
        <p class="text-slate-500 text-sm mb-8 text-center">å¯¬åº¦ 1200px ç­‰æ¯”ä¾‹ | WebP é«˜æ•ˆå£“ç¸® | é«”ç©å¤§å¹…ç¸®æ¸›</p>

        <div class="space-y-6">
            <div class="grid grid-cols-2 gap-4 text-left">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">è‹±æ–‡åç¨± (å¾Œç¶´)</label>
                    <input type="text" id="suffixInput" placeholder="ä¾‹å¦‚: product_view" 
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">å£“ç¸®æ·±åº¦ (è¶Šå°æª”æ¡ˆè¶Šå°)</label>
                    <select id="qualityInput" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm bg-white">
                        <option value="0.8">å¹³è¡¡æ¨¡å¼ (æ¨è–¦ SEO)</option>
                        <option value="0.6" selected>æ·±åº¦å£“ç¸® (æª”æ¡ˆæ¥µå°)</option>
                        <option value="0.4">æ¥µè‡´å£“ç¸® (é©åˆå¤šåœ–)</option>
                    </select>
                </div>
            </div>

            <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
            <button onclick="document.getElementById('fileInput').click()" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all text-lg">
                é¸å–åœ–ç‰‡ä¸¦é–‹å§‹è™•ç†
            </button>

            <div id="progressList" class="space-y-3 pt-4"></div>

            <button id="downloadBtn" style="display: none;"
                class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg transition-all">
                ä¸‹è¼‰å…¨éƒ¨è™•ç†å¥½çš„åœ–ç‰‡ (ZIP)
            </button>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const suffixInput = document.getElementById('suffixInput');
        const qualityInput = document.getElementById('qualityInput');
        const progressList = document.getElementById('progressList');
        const downloadBtn = document.getElementById('downloadBtn');

        let processedFiles = [];

        fileInput.addEventListener('change', async (e) => {
            const files = e.target.files;
            const suffix = suffixInput.value.trim();
            const quality = parseFloat(qualityInput.value);

            if (!suffix) { alert('è«‹è¼¸å…¥è‹±æ–‡åç¨±ï¼'); return; }
            progressList.innerHTML = '';
            processedFiles = [];

            for (let i = 0; i < files.length; i++) {
                const index = (i + 1).toString().padStart(2, '0');
                const newFileName = `${suffix}_${index}.webp`;

                const item = document.createElement('div');
                item.className = "p-4 bg-slate-50 rounded-xl border border-slate-100 flex flex-col gap-2";
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-slate-500">${newFileName}</span>
                        <span id="st-${i}" class="text-xs text-blue-500 font-bold italic">å„ªåŒ–ä¸­...</span>
                    </div>
                    <div id="action-${i}" class="hidden"></div>
                `;
                progressList.appendChild(item);

                const blob = await processImage(files[i], quality);
                processedFiles.push({ blob, name: newFileName });

                document.getElementById(`st-${i}`).innerText = 'âœ”ï¸ è™•ç†å®Œæˆ';
                document.getElementById(`st-${i}`).className = 'text-emerald-500 font-bold text-xs';
                
                const actionBox = document.getElementById(`action-${i}`);
                actionBox.className = "flex justify-end mt-1";
                const dlLink = document.createElement('button');
                dlLink.innerText = "ğŸ’¾ å–®å¼µä¸‹è¼‰";
                dlLink.className = "text-xs bg-white border border-slate-200 px-3 py-1 rounded-md hover:bg-slate-100 shadow-sm transition-colors";
                dlLink.onclick = () => {
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = newFileName;
                    a.click();
                };
                actionBox.appendChild(dlLink);
            }
            downloadBtn.style.display = 'block';
        });

        function processImage(file, quality) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        
                        // å¯¬åº¦å›ºå®š 1200ï¼Œé«˜åº¦ç­‰æ¯”ä¾‹
                        const targetWidth = 1200;
                        const scaleFactor = targetWidth / img.width;
                        const targetHeight = img.height * scaleFactor;

                        canvas.width = targetWidth;
                        canvas.height = targetHeight;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

                        // è½‰ç‚º WebP ä¸¦é€²è¡Œå“è³ªå£“ç¸®
                        canvas.toBlob((blob) => resolve(blob), 'image/webp', quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        downloadBtn.onclick = async () => {
            const zip = new JSZip();
            processedFiles.forEach(f => zip.file(f.name, f.blob));
            const content = await zip.generateAsync({type:"blob"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = `${suffixInput.value}_images.zip`;
            a.click();
        };
    </script>
</body>
</html>
